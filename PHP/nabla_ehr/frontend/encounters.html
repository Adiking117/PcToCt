<!-- ehr_app/frontend/encounters.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Patient Encounters</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <h1>ğŸ“„ Patient Encounters</h1>
  <button onclick="goBack()">â¬…ï¸ Back to Home</button>

  <section>
    <h2>Encounters</h2>
    <div id="encounter-list"></div>
  </section>

  <hr />

  <section>
    <h2>Add Encounter</h2>
    <input type="number" id="doctor-id" placeholder="Enter Doctor ID" />
    <button onclick="addEncounter()">Add Encounter</button>
  </section>

  <script>
    const API_BASE = "../backend/";
    const urlParams = new URLSearchParams(window.location.search);
    const patientId = urlParams.get("patient_id");

    function goBack() {
      window.location.href = "index.html";
    }

    function loadEncounters() {
      fetch(`${API_BASE}get_encounters.php?patient_id=${patientId}`)
        .then(res => res.json())
        .then(data => {
          const list = document.getElementById("encounter-list");
          list.innerHTML = "";

          if (data.length === 0) {
            list.innerHTML = "<p>No encounters yet.</p>";
            return;
          }

          data.forEach(e => {
            const item = document.createElement("div");
            item.innerHTML = `
              ğŸ©º Encounter ID: ${e.encounter_id} | Doctor ID: ${e.doctor_id}
              <button onclick="viewNotes(${e.encounter_id})">View Notes</button>
            `;
            list.appendChild(item);
          });
        });
    }

    function viewNotes(encounterId) {
      // Redirect with both patient and encounter IDs
      window.location.href = `soap.html?patient_id=${patientId}&encounter_id=${encounterId}`;
    }


    function addEncounter() {
      const doctorId = document.getElementById("doctor-id").value;

      fetch(`${API_BASE}add_encounter.php`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ patient_id: patientId, doctor_id: doctorId })
      })
        .then(res => res.json())
        .then(data => {
          alert("Encounter added!");
          document.getElementById("doctor-id").value = "";
          loadEncounters();
        });
    }

    window.onload = loadEncounters;
  </script>
</body>
</html>
